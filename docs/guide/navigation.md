# 导航模块

导航模块是自动驾驶车辆的关键组成部分，负责引导车辆从一个点移动到另一个点。它承担着诸如确定最佳整体路径（全局路径规划）、规划短期行动（局部路径规划）以及控制车辆实际如何移动等重要任务。

为了使导航模块工作，它需要获取车辆位置（定位）和详细地图等信息。随后，它决定诸如车辆应以多快速度行驶及如何转向等关键细节。这些决策随后被发送至控制模块，后者据此操控车辆移动。

具体而言，导航模块中的规划部分有两项任务。首先，全局路径规划确定了车辆当前位置到目标位置的最佳行进路线。其次，局部规划实时生成车辆应遵循的短期计划，特别是在遇到意外障碍时。

在控制系统领域中，诸如PID（比例-积分-微分）和LQR（线性二次调节器）等成熟算法已发展至高级阶段。在PAVs中，PID控制的实现已集成并嵌入到MCU控制板中，确保响应速度并满足实时操作需求。

## 导航算法列表

ISSPA在导航模块中部署了一项或多项用于规划和控制任务的基准算法。对于规划，主要依赖ROS导航堆栈提供的技术路径，而控制方面则融入了经典的PID控制算法，该算法已烧录到开发板上。

以下是每项任务实施的算法分解：

| 规划（ROS导航堆栈）|        | 控制 |
|-----------------|--------|---------|
| **全局规划器**          | **局部规划器** | **PID** |
| A*                | TEB     | ...     |
| D*                | DWA     | ...     |
| PSO               | ...    | ...     |

接下来的部分，我们将更详细地讨论这些任务。

## 规划

ISSPA采用ROS导航堆栈执行规划任务。ROS导航堆栈是机器人研究领域的综合规划框架，作为复杂的导航解决方案。它包含多种算法和模块，使机器人能够自主穿越环境并避免障碍。该堆栈包括如定位、映射和路径规划等基本组件，为机器人导航挑战提供全面解决方案。

在ISSPA中，我们采用了一系列基础算法，涵盖了从基线方法到先进全局和局部规划策略。使用D*和A*等知名全局规划算法来勾勒最优路径，而TEB和DWA等局部规划算法则有助于精细和适应性的轨迹规划。为了提高用户友好性，每个算法都配有自己的参数文件，简化了参数快速优化过程。

[./imgs/indoor_navigation_demo.png](./imgs/indoor_navigation_demo.png)

*室内导航示例*

上图展示的是实验室环境下导航算法的测试，绿色线条代表由全局规划（D*）生成的轨迹，蓝色线条代表由局部规划（TEB）生成的轨迹，而围绕车辆的彩色点则是3D激光雷达的回波点。

## 控制

在控制模块中，我们将比例-积分-微分（PID）算法无缝集成到微控制器单元（MCU）中。PID算法以其经典简洁和易于实现而著称，成为系统控制动态的核心。

[./imgs/PID_wiki.png](./imgs/PID_wiki.png)

[PID控制器框图](https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller)

图显示了一个反馈环中的PID控制器框图，其中$r(t)$为期望过程变量（PV）或设定点（SP），$y(t)$为测量的PV。

在ISSPA中，PID控制变量可以包括`角速度`、`线速度`等。

## 输入与输出

本节旨在展示不同规划和控制算法的输入与输出，为您提供全面的参考和理解。

| 算法       | 类型            | 输入                                      | 输出                                   |
|------------|-----------------|---------------------------------------------|-------------------------------------------|
| A* / D* / PSO | 全局规划器 | a. 起始与目标位置<br>b. 地图信息 | 计划的全局路径（路线）               |
| DWA / TEB  | 局部规划器   | a. 全局路径<br>b. 地图信息<br>c. 机器人动力学与约束 | a. 计划的局部轨迹<br>b. 线速度和角速度 |
| PID        | 控制器      | a. 期望线性和角速度<br>b. 当前线性和角速度 | a. 电机速度控制：PWM值<br>b. 偏航控制：角速度 |

## 全局规划器

在ROS导航堆栈中，D*（D星）和A*（A星）算法主要用于全局路径规划。

它们的输入通常包括：
- **起始与目标位置** — 描述机器人初始位置（坐标）及其目标目的地。
- **地图信息** — 通常以网格地图等形式表示，指示可通行区域、障碍物及机器人环境中的其他地形信息。

它们的输出通常包括：
- **计划的全局路径（路线）** — 主要输出是从起点到目标位置计算出的路径，考虑了地图信息和这些算法实施的避障策略。

## 局部规划器

在ROS导航堆栈中，TEB（定时弹性带）和DWA（动态窗口方法）算法主要用于局部轨迹规划。

它们的输入通常包括：
- **全局路径** — 由全局规划器获得的路径或轨迹。
- **局部地图信息** — 通常以局部网格地图形式表示。
- **机器人的运动学和动力学约束** — 关于车辆物理限制的信息，例如最大速度、加速度和其他运动学约束。

它们的输出通常包括：
- **计划的局部轨迹** — 考虑动态约束和局部地图信息的轨迹，确保避碰和运动学可行性。
- **车辆线速度和角速度** — 发送给控制任务以控制车辆的速度指令。

## 控制器

在控制任务中，PID是一种经典方法。

其输入是：
- **期望车辆线速度和角速度** — 由`局部规划器`提供的车辆线速度和角速度。
- **当前车辆线速度和角速度**。

其输出是：
- **电机速度控制** — PWM值。
- **偏航控制** — 角速度。

## 参考

- [ROS导航堆栈ROS维基](https://wiki.ros.org/navigation)。
- [move_base ROS维基](https://wiki.ros.org/move_base)。
- [global_planner ROS维基](https://wiki.ros.org/global_planner)。
- [PSO全局规划器GitHub](https://github.com/JZX-MY/pso_global_planner)。
- [dwa_local_planner ROS维基](https://wiki.ros.org/dwa_local_planner)。
- [teb_local_planner ROS维基](https://wiki.ros.org/teb_local_planner)。
- [PID维基](https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller)。